<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pokédex — Fetch + JS</title>
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#ef5350;
      --glass: rgba(255,255,255,0.6);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#e6eefc 0%, #f5f7fb 100%);color:#111}
    .app{
      max-width:1100px;margin:32px auto;padding:20px;
    }
    header{
      display:flex;gap:12px;align-items:center;justify-content:space-between;
      margin-bottom:18px;
    }
    .brand{
      display:flex;gap:12px;align-items:center;
    }
    .logo{
      width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg,#fff 0%, #ffe7e7 100%);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);box-shadow:0 6px 20px rgba(14,30,37,0.06);
    }
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:12px;align-items:center}
    input[type="search"]{
      padding:10px 12px;border-radius:10px;border:1px solid #e6e9ee;background:var(--card);width:260px;outline:none;
      box-shadow:0 1px 0 rgba(16,24,40,0.02);
    }
    button.btn{
      padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;
    }
    .grid{
      display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;
    }
    .card{
      background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06);cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;display:flex;flex-direction:column;gap:10px;align-items:center;
    }
    .card:hover{transform:translateY(-6px)}
    .number{font-size:12px;color:var(--muted);align-self:flex-start}
    .poke-img{width:96px;height:96px;display:flex;align-items:center;justify-content:center;}
    .name{font-weight:700;text-transform:capitalize}
    .meta{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
    .chip{font-size:12px;padding:6px 8px;border-radius:999px;background:var(--glass);border:1px solid rgba(0,0,0,0.04)}
    .pager{display:flex;gap:8px;justify-content:center;margin-top:18px}
    .tiny{font-size:13px;color:var(--muted)}
    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(11,15,23,0.5);display:flex;align-items:center;justify-content:center;padding:20px;z-index:40}
    .modal{width:100%;max-width:740px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(11,15,23,0.3);position:relative}
    .modal-close{position:absolute;right:12px;top:12px;border:0;background:transparent;font-size:18px;cursor:pointer}
    .modal-grid{display:grid;grid-template-columns:220px 1fr;gap:18px;align-items:center}
    .type{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);text-transform:capitalize;margin-right:6px}
    footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:600px){
      .modal-grid{grid-template-columns:1fr}
      input[type="search"]{width:140px}
      .brand h1{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">PK</div>
        <div>
          <h1>Pokédex</h1>
          <div class="tiny">Fetch + PokeAPI — HTML/CSS/JS</div>
        </div>
      </div>

      <div class="controls">
        <input id="search" type="search" placeholder="Nome ou ID (ex: pikachu | 25)" />
        <button id="searchBtn" class="btn">Buscar</button>
        <button id="resetBtn" class="btn" style="background:#6b7280">Reset</button>
      </div>
    </header>

    <main>
      <div id="status" class="tiny" style="margin-bottom:8px">Carregando Pokémons...</div>
      <div id="list" class="grid"></div>

      <div class="pager" style="margin-top:18px">
        <button id="prev" class="btn" style="background:#9ca3af">Anterior</button>
        <div id="pageInfo" class="tiny" style="align-self:center;padding:6px 10px">Página 1</div>
        <button id="next" class="btn">Próxima</button>
      </div>
    </main>

    <footer>Dados via <a href="https://pokeapi.co" target="_blank" rel="noopener">PokeAPI</a></footer>
  </div>

  <!-- Modal container (injetado dinamicamente) -->
  <div id="modalRoot"></div>

  <script>
    // Config
    const API_BASE = 'https://pokeapi.co/api/v2';
    const LIMIT = 24; // quantos pokémons por página
    let offset = 0;
    let totalCount = null;

    // Elementos
    const listEl = document.getElementById('list');
    const statusEl = document.getElementById('status');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const pageInfo = document.getElementById('pageInfo');
    const searchInput = document.getElementById('search');
    const searchBtn = document.getElementById('searchBtn');
    const resetBtn = document.getElementById('resetBtn');
    const modalRoot = document.getElementById('modalRoot');

    // Função utilitária para buscar JSON e tratar erros
    async function fetchJson(url){
      try {
        const res = await fetch(url);
        if(!res.ok) throw new Error('Erro na requisição: ' + res.status);
        return await res.json();
      } catch (err) {
        console.error(err);
        throw err;
      }
    }

    // Pegar lista (name + url)
    async function loadList(){
      statusEl.textContent = 'Carregando pokémons...';
      listEl.innerHTML = '';
      try {
        const data = await fetchJson(`${API_BASE}/pokemon?limit=${LIMIT}&offset=${offset}`);
        totalCount = data.count;
        pageInfo.textContent = `Página ${Math.floor(offset / LIMIT) + 1} — ${offset + 1} a ${Math.min(offset+LIMIT, totalCount)} de ${totalCount}`;
        // Buscar detalhes em paralelo (para sprites/tipos)
        const promises = data.results.map(r => fetchJson(r.url).catch(e => null));
        const details = await Promise.all(promises);
        details.forEach(d => {
          if(d) listEl.appendChild(createCard(d));
        });
        statusEl.textContent = '';
      } catch (err) {
        statusEl.textContent = 'Erro ao carregar lista. Veja console.';
      }
      updatePager();
    }

    // Criar cartão
    function createCard(poke){
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.name = poke.name;

      const num = document.createElement('div');
      num.className = 'number';
      num.textContent = `#${String(poke.id).padStart(3,'0')}`;
      card.appendChild(num);

      const imgWrap = document.createElement('div');
      imgWrap.className = 'poke-img';
      const img = document.createElement('img');
      img.alt = poke.name;
      img.width = 96; img.height = 96;

      // sprite preferida: official-artwork, fallback para front_default
      const sprite = poke.sprites?.other?.['official-artwork']?.front_default || poke.sprites?.front_default || '';
      img.src = sprite || '';
      img.onerror = () => { img.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96"><rect width="100%" height="100%" fill="%23f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="10" fill="%23a1a1aa">sem imagem</text></svg>'; }
      imgWrap.appendChild(img);
      card.appendChild(imgWrap);

      const name = document.createElement('div');
      name.className = 'name';
      name.textContent = poke.name;
      card.appendChild(name);

      const meta = document.createElement('div');
      meta.className = 'meta';
      // tipos
      (poke.types || []).forEach(t => {
        const span = document.createElement('span');
        span.className = 'chip';
        span.textContent = t.type.name;
        meta.appendChild(span);
      });
      card.appendChild(meta);

      // abrir modal ao clicar
      card.addEventListener('click', () => openModal(poke));
      return card;
    }

    // Modal de detalhe
    function openModal(poke){
      modalRoot.innerHTML = `
        <div class="modal-backdrop" id="backdrop">
          <div class="modal" role="dialog" aria-modal="true" aria-label="Detalhes do ${poke.name}">
            <button class="modal-close" id="closeBtn">&times;</button>
            <div class="modal-grid">
              <div style="text-align:center">
                <img src="${poke.sprites?.other?.['official-artwork']?.front_default || poke.sprites.front_default || ''}" alt="${poke.name}" style="width:180px;height:180px;object-fit:contain" onerror="this.style.display='none'"/>
                <div class="tiny" style="margin-top:8px">#${String(poke.id).padStart(3,'0')}</div>
                <h2 style="text-transform:capitalize;margin:6px 0">${poke.name}</h2>
                <div>${(poke.types||[]).map(t=>`<span class="type">${t.type.name}</span>`).join(' ')}</div>
              </div>
              <div>
                <h3 style="margin:0 0 8px 0">Informações</h3>
                <p class="tiny">Altura: <strong>${poke.height}</strong> • Peso: <strong>${poke.weight}</strong></p>
                <h4 style="margin:12px 0 6px 0">Habilidades</h4>
                <div class="tiny">${(poke.abilities||[]).map(a=>a.ability.name).join(', ')}</div>
                <h4 style="margin:12px 0 6px 0">Status (base)</h4>
                <div class="tiny">
                  ${(poke.stats||[]).map(s=>`${s.stat.name}: ${s.base_stat}`).join(' • ')}
                </div>
                <h4 style="margin:12px 0 6px 0">Movimentos (5 primeiros)</h4>
                <div class="tiny">${(poke.moves||[]).slice(0,5).map(m=>m.move.name).join(', ') || '—'}</div>
                <div style="margin-top:14px">
                  <a href="${poke.species?.url || '#'}" target="_blank" class="tiny">Ver species (API)</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      // handlers
      document.getElementById('closeBtn').addEventListener('click', closeModal);
      document.getElementById('backdrop').addEventListener('click', (e) => {
        if(e.target.id === 'backdrop') closeModal();
      });
      document.addEventListener('keydown', onEsc);
    }

    function closeModal(){
      modalRoot.innerHTML = '';
      document.removeEventListener('keydown', onEsc);
    }
    function onEsc(e){ if(e.key === 'Escape') closeModal(); }

    // Paginação
    prevBtn.addEventListener('click', () => {
      offset = Math.max(0, offset - LIMIT);
      loadList();
    });
    nextBtn.addEventListener('click', () => {
      if(totalCount === null) return;
      offset = Math.min(totalCount - LIMIT, offset + LIMIT);
      loadList();
    });
    function updatePager(){
      prevBtn.disabled = offset === 0;
      nextBtn.disabled = totalCount !== null && (offset + LIMIT) >= totalCount;
      prevBtn.style.opacity = prevBtn.disabled ? 0.6 : 1;
      nextBtn.style.opacity = nextBtn.disabled ? 0.6 : 1;
    }

    // Buscar por nome/id
    async function searchPokemon(term){
      if(!term) { loadList(); return; }
      statusEl.textContent = `Buscando "${term}"...`;
      listEl.innerHTML = '';
      try {
        const data = await fetchJson(`${API_BASE}/pokemon/${encodeURIComponent(term.toLowerCase())}`);
        listEl.appendChild(createCard(data));
        statusEl.textContent = '';
        pageInfo.textContent = `Resultado da busca`;
      } catch (err) {
        statusEl.textContent = 'Pokémon não encontrado. Tente outro nome ou ID.';
      }
    }

    searchBtn.addEventListener('click', () => {
      const t = searchInput.value.trim();
      searchPokemon(t);
    });
    searchInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter') searchPokemon(searchInput.value.trim());
    });
    resetBtn.addEventListener('click', () => {
      searchInput.value = '';
      offset = 0;
      loadList();
    });

    // Inicializa
    loadList();
  </script>
</body>
</html>
